
BEGIN TRY
BEGIN tran

UPDATE [T_Carfare] SET [UpdTime] = SYSDATETIME(), [UpdUser] = @UpdUser, [Status] = 2, [WriteStatus] = @WriteStatus WHERE [carfareID] = @carfareID

DELETE FROM [S_Session] WHERE [carfareID] = @carfareID

COMMIT tran
END TRY

BEGIN CATCH

    declare @ErrorMessage nvarchar(4000)
    declare @ErrorSeverity int
    declare @ErrorState int

    SELECT @ErrorMessage = ERROR_MESSAGE(),
           @ErrorSeverity = ERROR_SEVERITY(),
           @ErrorState = ERROR_STATE()

	RAISERROR (@ErrorMessage, -- Message text.
               @ErrorSeverity, -- Severity.
               @ErrorState -- State.
               );

	ROLLBACK tran

END CATCH
